{"ast":null,"code":"import { useState, useCallback, useEffect } from 'react';\nimport { useWindowEvent } from '../use-window-event/use-window-event.js';\n\nfunction serializeJSON(value) {\n  try {\n    return JSON.stringify(value);\n  } catch (error) {\n    throw new Error(\"@mantine/hooks use-local-storage: Failed to serialize the value\");\n  }\n}\n\nfunction deserializeJSON(value) {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n}\n\nfunction useLocalStorage({\n  key,\n  defaultValue = void 0,\n  getInitialValueInEffect = true,\n  deserialize = deserializeJSON,\n  serialize = serializeJSON\n}) {\n  var _a;\n\n  const [value, setValue] = useState(typeof window !== \"undefined\" && \"localStorage\" in window && !getInitialValueInEffect ? deserialize((_a = window.localStorage.getItem(key)) != null ? _a : void 0) : defaultValue != null ? defaultValue : \"\");\n  const setLocalStorageValue = useCallback(val => {\n    if (val instanceof Function) {\n      setValue(current => {\n        const result = val(current);\n        window.localStorage.setItem(key, serialize(result));\n        window.dispatchEvent(new CustomEvent(\"mantine-local-storage\", {\n          detail: {\n            key,\n            value: val(current)\n          }\n        }));\n        return result;\n      });\n    } else {\n      window.localStorage.setItem(key, serialize(val));\n      window.dispatchEvent(new CustomEvent(\"mantine-local-storage\", {\n        detail: {\n          key,\n          value: val\n        }\n      }));\n      setValue(val);\n    }\n  }, [key]);\n  useWindowEvent(\"storage\", event => {\n    var _a2;\n\n    if (event.storageArea === window.localStorage && event.key === key) {\n      setValue(deserialize((_a2 = event.newValue) != null ? _a2 : void 0));\n    }\n  });\n  useWindowEvent(\"mantine-local-storage\", event => {\n    if (event.detail.key === key) {\n      setValue(event.detail.value);\n    }\n  });\n  useEffect(() => {\n    if (defaultValue !== void 0 && value === void 0) {\n      setLocalStorageValue(defaultValue);\n    }\n  }, [defaultValue, value, setLocalStorageValue]);\n  useEffect(() => {\n    var _a2;\n\n    if (getInitialValueInEffect) {\n      setValue(deserialize((_a2 = window.localStorage.getItem(key)) != null ? _a2 : void 0) || (defaultValue != null ? defaultValue : \"\"));\n    }\n  }, []);\n  return [value === void 0 ? defaultValue : value, setLocalStorageValue];\n}\n\nexport { useLocalStorage };","map":{"version":3,"sources":["../../src/use-local-storage/use-local-storage.ts"],"names":[],"mappings":"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","sourcesContent":["import { useState, useCallback, useEffect } from 'react';\nimport { useWindowEvent } from '../use-window-event/use-window-event';\n\ninterface UseLocalStorage<T> {\n  /** Local storage key */\n  key: string;\n\n  /** Default value that will be set if value is not found in local storage */\n  defaultValue?: T;\n\n  /** If set to true, value will be update is useEffect after mount */\n  getInitialValueInEffect?: boolean;\n\n  /** Function to serialize value into string to be save in local storage */\n  serialize?(value: T): string;\n\n  /** Function to deserialize string value from local storage to value */\n  deserialize?(value: string): T;\n}\n\nfunction serializeJSON<T>(value: T) {\n  try {\n    return JSON.stringify(value);\n  } catch (error) {\n    throw new Error('@mantine/hooks use-local-storage: Failed to serialize the value');\n  }\n}\n\nfunction deserializeJSON(value: string) {\n  try {\n    return JSON.parse(value);\n  } catch {\n    return value;\n  }\n}\n\nexport function useLocalStorage<T = string>({\n  key,\n  defaultValue = undefined,\n  getInitialValueInEffect = true,\n  deserialize = deserializeJSON,\n  serialize = serializeJSON,\n}: UseLocalStorage<T>) {\n  const [value, setValue] = useState<T>(\n    typeof window !== 'undefined' && 'localStorage' in window && !getInitialValueInEffect\n      ? deserialize(window.localStorage.getItem(key) ?? undefined)\n      : ((defaultValue ?? '') as T)\n  );\n\n  const setLocalStorageValue = useCallback(\n    (val: T | ((prevState: T) => T)) => {\n      if (val instanceof Function) {\n        setValue((current) => {\n          const result = val(current);\n          window.localStorage.setItem(key, serialize(result));\n          window.dispatchEvent(\n            new CustomEvent('mantine-local-storage', { detail: { key, value: val(current) } })\n          );\n          return result;\n        });\n      } else {\n        window.localStorage.setItem(key, serialize(val));\n        window.dispatchEvent(\n          new CustomEvent('mantine-local-storage', { detail: { key, value: val } })\n        );\n        setValue(val);\n      }\n    },\n    [key]\n  );\n\n  useWindowEvent('storage', (event) => {\n    if (event.storageArea === window.localStorage && event.key === key) {\n      setValue(deserialize(event.newValue ?? undefined));\n    }\n  });\n\n  useWindowEvent('mantine-local-storage', (event) => {\n    if (event.detail.key === key) {\n      setValue(event.detail.value);\n    }\n  });\n\n  useEffect(() => {\n    if (defaultValue !== undefined && value === undefined) {\n      setLocalStorageValue(defaultValue);\n    }\n  }, [defaultValue, value, setLocalStorageValue]);\n\n  useEffect(() => {\n    if (getInitialValueInEffect) {\n      setValue(\n        deserialize(window.localStorage.getItem(key) ?? undefined) || ((defaultValue ?? '') as T)\n      );\n    }\n  }, []);\n\n  return [value === undefined ? defaultValue : value, setLocalStorageValue] as const;\n}\n"]},"metadata":{},"sourceType":"module"}